{% extends "base.html" %}
{% block title %}Kontoeinstellungen - Ouhud QR{% endblock %}

{% block content %}
<section class="settings-wrap">
  <header class="head">
    <h1>Kontoeinstellungen</h1>
    <p>Konto, E-Mail und Passwort zentral verwalten.</p>
  </header>

  {% if request.query_params.get("msg") == "profile_updated" %}
    <div class="alert ok">Profil wurde erfolgreich aktualisiert.</div>
  {% endif %}
  {% if request.query_params.get("error") == "duplicate_user" %}
    <div class="alert err">Benutzername oder E-Mail ist bereits vergeben.</div>
  {% endif %}

  <div class="grid">
    <article class="card">
      <h2>Profil bearbeiten</h2>
      <form method="post" action="/settings/update-profile">
        <label for="first_name">Vorname</label>
        <input id="first_name" name="first_name" type="text" value="{{ user.first_name or '' }}">

        <label for="last_name">Nachname</label>
        <input id="last_name" name="last_name" type="text" value="{{ user.last_name or '' }}">

        <label for="username">Benutzername *</label>
        <input id="username" name="username" type="text" value="{{ user.username or '' }}" required>

        <label for="email">E-Mail *</label>
        <input id="email" name="email" type="email" value="{{ user.email or '' }}" required>

        <button class="btn primary" type="submit">Profil speichern</button>
      </form>
      <a class="btn ghost" href="/profile">Profilseite öffnen (Bild, QR-Liste)</a>
    </article>

    <article class="card">
      <h2>Passwort ändern</h2>
      <form method="post" action="/settings/security/change-password">
        <label for="old_password">Aktuelles Passwort *</label>
        <input id="old_password" name="old_password" type="password" required>

        <label for="new_password">Neues Passwort *</label>
        <input id="new_password" name="new_password" type="password" required>

        <label for="confirm_password">Neues Passwort bestätigen *</label>
        <input id="confirm_password" name="confirm_password" type="password" required>

        <button class="btn primary" type="submit">Passwort aktualisieren</button>
      </form>
      <a class="btn ghost" href="/settings/security">Erweiterte Sicherheit</a>
    </article>
  </div>

  <article class="card plan">
    <h2>Plan und Nutzung</h2>
    <p><strong>Aktueller Plan:</strong> {{ plan }}</p>
    <p><strong>Preis:</strong> {{ price }}</p>
    <p><strong>Erstellte QR-Codes:</strong> {{ qr_count }}</p>
    {% if features %}
      <ul>
        {% for f in features %}
          <li>{{ f }}</li>
        {% endfor %}
      </ul>
    {% endif %}
    <a class="btn ghost" href="/settings/billing">Abonnement und Rechnungen</a>
  </article>
</section>

<style>
.settings-wrap { max-width: 980px; margin: 0 auto; }
.head h1 { margin-bottom: .3rem; }
.head p { margin-top: 0; color: #64748b; }
.grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 1rem;
}
.card {
  background: #fff;
  border: 1px solid #e2e8f0;
  border-radius: 14px;
  padding: 1rem;
}
.card h2 { margin-top: 0; color: #0d2a78; }
label { display: block; margin: .6rem 0 .25rem; font-weight: 600; }
input {
  width: 100%;
  box-sizing: border-box;
  border: 1px solid #cbd5e1;
  border-radius: 10px;
  padding: .68rem;
}
.btn {
  display: inline-block;
  margin-top: .9rem;
  padding: .62rem .95rem;
  border-radius: 10px;
  text-decoration: none;
  border: 1px solid #2563eb;
}
.btn.primary { background: #2563eb; color: #fff; }
.btn.ghost { background: #fff; color: #2563eb; margin-left: .4rem; }
.alert {
  border-radius: 10px;
  padding: .6rem .8rem;
  margin-bottom: .8rem;
  font-weight: 600;
}
.alert.ok { background: #ecfdf5; border: 1px solid #86efac; color: #166534; }
.alert.err { background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; }
.plan ul { margin: .5rem 0 0; padding-left: 1.1rem; }
@media (max-width: 860px) {
  .grid { grid-template-columns: 1fr; }
  .btn.ghost { margin-left: 0; }
}
</style>
{% endblock %}
