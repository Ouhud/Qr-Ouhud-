{% extends "base.html" %}
{% set lang = request.state.lang if request and request.state else 'de' %}
{% if lang == 'en' %}
  {% set t_title = 'ğŸ“¨ Email QR code created â€“ Ouhud QR' %}
  {% set t_h1 = 'âœ… Email QR code created successfully' %}
  {% set t_sub = 'Scan the code or click below to open your email or download the QR code.' %}
  {% set t_open = 'ğŸ“§ Open email' %}
  {% set t_dynamic = 'Dynamic link:' %}
  {% set t_open_dynamic = 'ğŸ”— Open dynamic link' %}
  {% set t_download = 'â¬‡ï¸ Download QR code' %}
  {% set t_print = 'ğŸ–¨ï¸ Print QR code' %}
  {% set t_share = 'ğŸ”— Share or embed' %}
  {% set t_copy = 'ğŸ“‹ Copy' %}
  {% set t_copied = 'ğŸ”— Link copied!' %}
{% elif lang == 'ar' %}
  {% set t_title = 'ğŸ“¨ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ QR Ù„Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ â€“ Ouhud QR' %}
  {% set t_h1 = 'âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ QR Ù„Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¨Ù†Ø¬Ø§Ø­' %}
  {% set t_sub = 'Ø§Ù…Ø³Ø­ Ø§Ù„Ø±Ù…Ø² Ø£Ùˆ Ø§Ù†Ù‚Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„ÙØªØ­ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ØªÙ†Ø²ÙŠÙ„ Ø±Ù…Ø² QR.' %}
  {% set t_open = 'ğŸ“§ ÙØªØ­ Ø§Ù„Ø¨Ø±ÙŠØ¯' %}
  {% set t_dynamic = 'Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ:' %}
  {% set t_open_dynamic = 'ğŸ”— ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ' %}
  {% set t_download = 'â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ Ø±Ù…Ø² QR' %}
  {% set t_print = 'ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø±Ù…Ø² QR' %}
  {% set t_share = 'ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ© Ø£Ùˆ ØªØ¶Ù…ÙŠÙ†' %}
  {% set t_copy = 'ğŸ“‹ Ù†Ø³Ø®' %}
  {% set t_copied = 'ğŸ”— ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!' %}
{% else %}
  {% set t_title = 'ğŸ“¨ E-Mail-QR-Code erstellt â€“ Ouhud QR' %}
  {% set t_h1 = 'âœ… E-Mail-QR-Code erfolgreich erstellt' %}
  {% set t_sub = 'Scanne den Code oder klicke unten, um deine E-Mail zu Ã¶ffnen oder den QR-Code herunterzuladen.' %}
  {% set t_open = 'ğŸ“§ E-Mail Ã¶ffnen' %}
  {% set t_dynamic = 'Dynamischer Link:' %}
  {% set t_open_dynamic = 'ğŸ”— Dynamischen Link Ã¶ffnen' %}
  {% set t_download = 'â¬‡ï¸ QR-Code herunterladen' %}
  {% set t_print = 'ğŸ–¨ï¸ QR-Code drucken' %}
  {% set t_share = 'ğŸ”— Teilen oder einbetten' %}
  {% set t_copy = 'ğŸ“‹ Kopieren' %}
  {% set t_copied = 'ğŸ”— Link kopiert!' %}
{% endif %}
{% block title %}{{ t_title }}{% endblock %}

{% block content %}
{% include "partials/qr_result_warnings.html" %}
<section class="qr-result qr-result-unified">
  <h1>{{ t_h1 }}</h1>
  <p class="subtitle">{{ t_sub }}</p>

  <div class="qr-card">
    <div class="qr-image-container">
      {% if qr_image %}
        <img src="data:image/png;base64,{{ qr_image }}" alt="E-Mail QR-Code Vorschau" class="qr-image">
      {% elif qr and qr.image_path %}
        <img src="/{{ qr.image_path }}" alt="E-Mail QR-Code Vorschau" class="qr-image">
      {% endif %}
    </div>

    <div class="qr-details">
      <h2>{{ title }}</h2>
      <p class="email-link">
        <a href="{{ mailto_url }}" target="_blank">{{ t_open }}</a>
      </p>
    </div>

    <div class="qr-actions">
      {% if dynamic_url %}
      <a href="{{ dynamic_url }}" target="_blank" rel="noopener" class="btn secondary">{{ t_open_dynamic }}</a>
      {% endif %}
      {% if qr and qr.slug %}
      <a href="/qr/export/{{ qr.slug }}?format=png" download="email_qr.png" class="btn primary">{{ t_download }}</a>
      {% else %}
      <a href="data:image/png;base64,{{ qr_image }}" download="email_qr.png" class="btn primary">{{ t_download }}</a>
      {% endif %}
      <button onclick="printQR()" class="btn secondary">{{ t_print }}</button>
    </div>

    <div class="share-section">
      <h3>{{ t_share }}</h3>
      {% if dynamic_url %}
      <p style="margin:0 0 0.8rem;"><strong>{{ t_dynamic }}</strong> <a href="{{ dynamic_url }}" target="_blank" rel="noopener">{{ dynamic_url }}</a></p>
      {% endif %}
      <input type="text" id="qrLink" value="{{ dynamic_url or request.url }}" readonly>
      <button onclick="copyLink()">{{ t_copy }}</button>
    </div>
  </div>
</section>

<style>
.qr-result {
  max-width: 850px;
  margin: 3rem auto;
  background: #fff;
  padding: 2.5rem;
  border-radius: 20px;
  box-shadow: 0 6px 25px rgba(0,0,0,0.08);
  text-align: center;
  font-family: "Inter", system-ui, sans-serif;
}
h1 { color: #0D2A78; font-size: 2rem; margin-bottom: 1rem; }
.subtitle { color: #475569; margin-bottom: 2rem; }
.qr-card { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
.qr-image-container { background: #f8fafc; padding: 1.5rem; border-radius: 16px; box-shadow: 0 3px 15px rgba(0,0,0,0.08); }
.qr-image { width: 250px; height: 250px; border-radius: 10px; }
.qr-details h2 { color: #0d2a78; font-size: 1.3rem; margin-top: 0.5rem; }
.email-link a { color: #2563eb; text-decoration: none; font-weight: 600; }
.email-link a:hover { text-decoration: underline; }
.qr-actions { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin-top: 1rem; }
.btn { padding: 0.9rem 1.6rem; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; border: none; text-decoration: none; display: inline-block; }
.btn.primary { background: linear-gradient(135deg,#0D2A78,#2563EB); color: white; }
.btn.primary:hover { background: linear-gradient(135deg,#0B1742,#1E40AF); }
.btn.secondary { background: linear-gradient(135deg,#1E3A8A,#0D2A78); color: white; }
.btn.secondary:hover { background: linear-gradient(135deg,#0D2A78,#1E3A8A); }
.share-section { margin-top: 2rem; background: #f9fafb; padding: 1.2rem; border-radius: 10px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); }
.share-section h3 { color: #0D2A78; margin-bottom: 0.6rem; }
#qrLink { width: 70%; padding: 0.6rem; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 0.95rem; text-align: center; margin-right: 0.5rem; }
.share-section button { background: #0D2A78; color: white; border: none; border-radius: 8px; padding: 0.6rem 1rem; font-weight: 600; cursor: pointer; }
.share-section button:hover { background: #1E40AF; }
@media (max-width: 700px) {
  .qr-result { padding: 2rem 1.2rem; }
  .qr-image { width: 220px; height: 220px; }
  #qrLink { width: 100%; margin-bottom: 0.6rem; }
  .share-section button { width: 100%; }
}
</style>

<script>
const EMAIL_LINK_COPIED_TEXT = {{ t_copied | tojson }};
function printQR() {
  return printQrFromSelector(".qr-image");
}
function copyLink() {
  const linkInput = document.getElementById('qrLink');
  linkInput.select();
  document.execCommand('copy');
  alert(EMAIL_LINK_COPIED_TEXT);
}
</script>
{% endblock %}
